<div #container class="container">
  <div class="card-stack">
    <!-- –ö–∞—Ä—Ç–æ—á–∫–∏ –∫–Ω–∏–≥ -->
    @for (book of books(); track book.id; let i = $index) {
      @if (i === currentIndex()) {
        <div class="card current" 
             [style.transform]="getCardTransform()"
             [style.opacity]="getCardOpacity()">
          <div class="book-card">
            <div class="content">
              <!-- –û–±–ª–æ–∂–∫–∞ –∫–Ω–∏–≥–∏ -->
              <div class="book-cover">
                @if (book.image) {
                  <img [ngSrc]="book.image" alt="–û–±–ª–æ–∂–∫–∞ {{book.title}}" class="cover-image" width="232px" height="320px" />
                } @else {
                  <div class="cover-placeholder">
                    üìö
                  </div>
                }
              </div>

              <h2 class="title">{{ book.title }}</h2>
              
              <p class="description">{{ book.description }}</p>
              
              <div class="meta">
                <span class="author">{{ book.author }}</span>
                <tui-badge class="year">{{ book.year }}</tui-badge>
              </div>
            </div>
          </div>

          <!-- –ë–æ–∫–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ -->
          <div class="side-buttons">
            <button 
              tuiButton 
              size="m"
              class="action-btn"
              (click)="navigateToBook()">
              üëÅÔ∏è
            </button>
            
            <button 
              tuiButton 
              size="m"
              appearance="secondary"
              class="action-btn like-btn"
              (click)="likeBook()">
              ‚ù§Ô∏è
            </button>
          </div>

          <!-- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ -->
          <div class="progress">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="(currentIndex() + 1) / books().length * 100"></div>
            </div>
            <span class="progress-text">{{ currentIndex() + 1 }} / {{ books().length }}</span>
          </div>

          <!-- –ö–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ -->
          <div class="nav-buttons">
            @if (currentIndex() > 0) {
              <button tuiButton size="s" (click)="prevBook()">‚Üê –ù–∞–∑–∞–¥</button>
            }
            @if (currentIndex() < books().length - 1) {
              <button tuiButton size="s" (click)="nextBook()">–î–∞–ª–µ–µ ‚Üí</button>
            }
          </div>
        </div>
      }
    }

    <!-- –°–æ–æ–±—â–µ–Ω–∏–µ –æ –∫–æ–Ω—Ü–µ —Å–ø–∏—Å–∫–∞ -->
    @if (currentIndex() >= books().length && books().length > 0) {
      <div class="end-message">
        <div class="message-card">
          <h3>üéâ –ù–∞ —Å–µ–≥–æ–¥–Ω—è –≤—Å–µ!</h3>
          <p>–ü—Ä–∏—Ö–æ–¥–∏ –∑–∞–≤—Ç—Ä–∞ –∑–∞ —Å–ª–µ–¥—É—é—â–∏–º–∏ –∫–Ω–∏–≥–∞–º–∏</p>
        </div>
      </div>
    }

    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ -->
    @if (books().length === 0) {
      <div class="loading">
        <div class="loading-card">
          <h3>–ó–∞–≥—Ä—É–∂–∞–µ–º –∫–Ω–∏–≥–∏...</h3>
          <p>–°–∫–æ—Ä–æ –∑–¥–µ—Å—å –ø–æ—è–≤—è—Ç—Å—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è</p>
          <tui-loader size="l"></tui-loader>
        </div>
      </div>
    }
  </div>
</div>